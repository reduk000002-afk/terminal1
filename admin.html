<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å | –¢–æ—Ä–≥–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª</title>
    <style>
        /* –°–¢–ò–õ–ò –û–°–¢–ê–í–õ–Ø–ï–ú –¢–ï –ñ–ï (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞) */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial; }
        body { background: linear-gradient(135deg, #0f172a, #1e293b); color: white; min-height: 100vh; }
        .login-page { display: flex; justify-content: center; align-items: center; height: 100vh; padding: 20px; }
        .login-box { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 15px; width: 100%; max-width: 400px; text-align: center; }
        .login-input { width: 100%; padding: 15px; margin-bottom: 20px; background: rgba(0,0,0,0.3); border: 2px solid #3b82f6; border-radius: 8px; color: white; font-size: 16px; }
        .login-btn { width: 100%; padding: 15px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; }
        .error { color: #f87171; margin-top: 15px; display: none; }
        .admin-page { display: none; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .admin-header { background: rgba(37,99,235,0.2); padding: 25px; border-radius: 15px; margin-bottom: 30px; }
        .users-table-container { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; margin-bottom: 30px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: rgba(59,130,246,0.2); padding: 15px; text-align: left; color: #93c5fd; }
        td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .table-input, .table-select { width: 100%; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid #3b82f6; border-radius: 5px; color: white; }
        .save-btn { width: 100%; padding: 18px; background: #16a34a; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .status { margin-top: 15px; padding: 12px; border-radius: 8px; text-align: center; font-weight: bold; display: none; }
        .status-success { background: rgba(34,197,94,0.2); color: #86efac; display: block; }
        .status-error { background: rgba(239,68,68,0.2); color: #fca5a5; display: block; }
    </style>
</head>
<body>
    <!-- –°–¢–†–ê–ù–ò–¶–ê –õ–û–ì–ò–ù–ê -->
    <div id="loginPage" class="login-page">
        <div class="login-box">
            <h2>üîê –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
            
            <input type="password" 
                   id="passwordInput" 
                   class="login-input" 
                   placeholder="–ü–∞—Ä–æ–ª—å (admin123)"
                   onkeypress="if(event.key=='Enter') login()">
            
            <button class="login-btn" onclick="login()">–í–æ–π—Ç–∏</button>
            
            <div id="loginError" class="error">‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</div>
        </div>
    </div>
    
    <!-- –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ -->
    <div id="adminPage" class="admin-page">
        <div class="admin-header">
            <div>
                <h1>üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
                <p style="color: #94a3b8;">–¢–æ—Ä–≥–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª | GitHub —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</p>
            </div>
            <button onclick="logout()" style="background:#dc2626; color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer;">
                üö™ –í—ã–π—Ç–∏
            </button>
        </div>
        
        <div class="users-table-container">
            <h3 style="margin-bottom: 20px; color: #60a5fa;">üë• –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>–õ–æ–≥–∏–Ω</th>
                        <th>Email</th>
                        <th>–ë–∞–ª–∞–Ω—Å (USDT)</th>
                        <th>–£—Ä–æ–≤–µ–Ω—å</th>
                        <th>–¢–∏–ø –≤—ã–≤–æ–¥–∞</th>
                    </tr>
                </thead>
                <tbody id="usersTable">
                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div style="background: rgba(34,197,94,0.1); padding: 25px; border-radius: 15px; margin-top: 30px;">
            <h3 style="color: #86efac; margin-bottom: 20px;">üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
            
            <button class="save-btn" onclick="saveToGitHub()">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ GitHub
            </button>
            
            <div id="saveStatus" class="status"></div>
            
            <div style="margin-top: 20px; padding: 15px; background: rgba(59,130,246,0.1); border-radius: 10px;">
                <p style="color: #93c5fd;">
                    <strong>–¢–æ–∫–µ–Ω –≤—Å—Ç—Ä–æ–µ–Ω –≤ –∫–æ–¥:</strong> –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –≤–≤–æ–¥–∞ —Ç–æ–∫–µ–Ω–∞
                </p>
            </div>
        </div>
    </div>

    <script>
        // ============ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ============
        const ADMIN_PASSWORD = 'admin123';
        const GITHUB_USERNAME = 'reduk000002-afk';
        const GITHUB_REPO = 'terminal1';
        const BASE_URL = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/main/`;
        
        // ============ –í–ê–® –¢–û–ö–ï–ù –ó–î–ï–°–¨ ============
        // –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–£ –°–¢–†–û–ö–£ –ù–ê –í–ê–® –†–ï–ê–õ–¨–ù–´–ô –¢–û–ö–ï–ù!
        const GITHUB_TOKEN = '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';
        // –ü—Ä–∏–º–µ—Ä: 'ghp_AbCdEfGhIjKlMnOpQrStUvWxYz1234567890'
        
        let usersData = {};
        
        // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============
        window.onload = function() {
            const isLoggedIn = localStorage.getItem('admin_logged_in') === 'true';
            if (isLoggedIn) {
                showAdminPage();
                loadUsers();
            }
        };
        
        // ============ –í–•–û–î ============
        function login() {
            const password = document.getElementById('passwordInput').value;
            const errorElement = document.getElementById('loginError');
            
            if (password === ADMIN_PASSWORD) {
                localStorage.setItem('admin_logged_in', 'true');
                showAdminPage();
                loadUsers();
            } else {
                errorElement.style.display = 'block';
                setTimeout(() => errorElement.style.display = 'none', 3000);
            }
        }
        
        function showAdminPage() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('adminPage').style.display = 'block';
        }
        
        function logout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏?')) {
                localStorage.removeItem('admin_logged_in');
                location.reload();
            }
        }
        
        // ============ –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ============
        async function loadUsers() {
            try {
                const response = await fetch(`${BASE_URL}users.json?t=${Date.now()}`);
                
                if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å');
                
                usersData = await response.json();
                renderUsersTable();
                
            } catch (error) {
                document.getElementById('usersTable').innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; color: #f87171; padding: 40px;">
                            ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                            <br>
                            <small>${error.message}</small>
                        </td>
                    </tr>
                `;
            }
        }
        
        function renderUsersTable() {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = '';
            
            for (const [username, user] of Object.entries(usersData)) {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td><strong>${username}</strong></td>
                    <td>${user.email || `${username}@galardro.org`}</td>
                    <td>
                        <input type="number" 
                               class="table-input"
                               value="${parseFloat(user.balance)}" 
                               step="0.01"
                               onchange="updateUser('${username}', 'balance', this.value)">
                    </td>
                    <td>
                        <select class="table-select" onchange="updateUser('${username}', 'level', this.value)">
                            <option value="–°—Ç–∞–Ω–¥–∞—Ä—Ç" ${user.level === '–°—Ç–∞–Ω–¥–∞—Ä—Ç' ? 'selected' : ''}>–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                            <option value="VIP 1" ${user.level === 'VIP 1' ? 'selected' : ''}>VIP 1</option>
                            <option value="VIP 2" ${user.level === 'VIP 2' ? 'selected' : ''}>VIP 2</option>
                            <option value="VIP 3" ${user.level === 'VIP 3' ? 'selected' : ''}>VIP 3</option>
                        </select>
                    </td>
                    <td>
                        <select class="table-select" onchange="updateUser('${username}', 'withdrawType', this.value)">
                            <option value="normal" ${user.withdrawType === 'normal' ? 'selected' : ''}>Normal</option>
                            <option value="request" ${user.withdrawType === 'request' ? 'selected' : ''}>Request</option>
                            <option value="commission" ${user.withdrawType === 'commission' ? 'selected' : ''}>Commission</option>
                        </select>
                    </td>
                `;
                
                tbody.appendChild(row);
            }
        }
        
        function updateUser(username, field, value) {
            if (!usersData[username]) return;
            
            if (field === 'balance') {
                usersData[username][field] = parseFloat(value).toFixed(2);
            } else {
                usersData[username][field] = value;
            }
        }
        
        // ============ –°–û–•–†–ê–ù–ï–ù–ò–ï –ù–ê GITHUB ============
        async function saveToGitHub() {
            const statusElement = document.getElementById('saveStatus');
            statusElement.textContent = '‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            statusElement.className = 'status';
            statusElement.style.display = 'block';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
            if (!GITHUB_TOKEN || GITHUB_TOKEN.includes('–≤–∞—à_–Ω–∞—Å—Ç–æ—è—â–∏–π')) {
                statusElement.textContent = '‚ùå –í—Å—Ç–∞–≤—å—Ç–µ GitHub Token –≤ –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ 98)';
                statusElement.className = 'status status-error';
                return;
            }
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è sha
                const getResponse = await fetch(`${BASE_URL}users.json`);
                let sha = '';
                
                if (getResponse.ok) {
                    const data = await getResponse.json();
                    if (data.sha) sha = data.sha;
                }
                
                // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(usersData, null, 2))));
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ GitHub
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/users.json`, {
                    method: 'PUT',
                    headers: {
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json',
                        'Authorization': `token ${GITHUB_TOKEN}`
                    },
                    body: JSON.stringify({
                        message: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –∞–¥–º–∏–Ω–∫–∏ ' + new Date().toLocaleString('ru-RU'),
                        content: content,
                        sha: sha || undefined
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    statusElement.textContent = '‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –Ω–∞ GitHub!';
                    statusElement.className = 'status status-success';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(loadUsers, 3000);
                    
                } else {
                    let errorMsg = result.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    
                    // –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
                    if (errorMsg.includes('bad credentials')) {
                        errorMsg = '–ù–µ–≤–µ—Ä–Ω—ã–π GitHub Token. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –Ω–∞ github.com/settings/tokens';
                    } else if (errorMsg.includes('not found')) {
                        errorMsg = '–§–∞–π–ª users.json –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏';
                    }
                    
                    throw new Error(errorMsg);
                }
                
            } catch (error) {
                statusElement.textContent = `‚ùå ${error.message}`;
                statusElement.className = 'status status-error';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º JSON –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                setTimeout(() => {
                    const jsonData = JSON.stringify(usersData, null, 2);
                    statusElement.innerHTML += `
                        <br><br>
                        <strong>üìã –î–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:</strong>
                        <ol style="text-align: left; margin: 10px 0;">
                            <li>–û—Ç–∫—Ä–æ–π—Ç–µ <a href="https://github.com/${GITHUB_USERNAME}/${GITHUB_REPO}/edit/main/users.json" target="_blank" style="color: #60a5fa;">users.json –Ω–∞ GitHub</a></li>
                            <li>–£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç</li>
                            <li>–í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç JSON:</li>
                        </ol>
                        <textarea 
                            style="width:100%; height:150px; margin-top:10px; padding:10px; border-radius:8px; 
                                   background:#1e293b; color:white; border:2px solid #3b82f6;"
                            onclick="this.select()">${jsonData}</textarea>
                        <p style="margin-top: 10px; color: #94a3b8;">
                            –ü–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ "Commit changes" –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        </p>
                    `;
                }, 1000);
            }
        }
    </script>
</body>
</html>
