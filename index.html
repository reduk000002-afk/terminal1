<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>–§—å—é—á–µ—Ä—Å–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª</title>
  <!-- Supabase SDK -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    /* –í–°–ï –°–¢–ò–õ–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô */
    * {
      box-sizing: border-box;
    }

    body {
      overflow-x: hidden;
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0d1117;
      color: #c9d1d9;
      -webkit-text-size-adjust: 100%;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    /* –í–°–ï –û–°–¢–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò –û–°–¢–ê–Æ–¢–°–Ø –¢–ê–ö–ò–ú–ò –ñ–ï */
    /* ... (–≤—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... */

  </style>
</head>
<body>
<!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
<div id="loginContainer" class="login-container">
  <div class="login-form">
    <h2>–í—Ö–æ–¥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª</h2>
    <input type="text" id="loginEmail" placeholder="–õ–æ–≥–∏–Ω" required>
    <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
    <button onclick="checkLogin()">–í–æ–π—Ç–∏</button>
    <div id="loginError" class="login-error">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>
    <div class="register-link">
      –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="https://www.galardro.org/" target="_blank">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
    </div>
  </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å–∫—Ä—ã—Ç –¥–æ –≤—Ö–æ–¥–∞) -->
<div id="mainContent" style="display: none;">
  <!-- –•–µ–¥–µ—Ä —Å –±–∞–ª–∞–Ω—Å–æ–º -->
  <div class="header-bar">
    <div class="balance-info">
      <div class="balance-item">
        <span class="balance-label">–ë–∞–ª–∞–Ω—Å:</span>
        <span class="balance-value" id="balanceValue">0.00 USDT</span>
      </div>
      <div class="balance-item">
        <span class="balance-label"></span>
        <span class="balance-value"> </span>
      </div>
      <div class="balance-item">
        <span class="balance-label"></span>
        <span class="balance-value positive" id="pnlValue"></span>
      </div>
    </div>
    <div class="user-menu">
      <span id="userLevel">–£—Ä–æ–≤–µ–Ω—å: 1</span>
      <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
      <div class="dropdown-menu" id="dropdownMenu">
        <div class="menu-item" onclick="showPage('trade')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/home.png" alt="" />
          –¢–æ—Ä–≥–æ–≤–ª—è
        </div>
        <div class="menu-item" onclick="showPage('profile')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/user-male-circle.png" alt="" />
          –ü—Ä–æ—Ñ–∏–ª—å
        </div>
        <div class="menu-item" onclick="showPage('deposit')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/money-transfer.png" alt="" />
          –î–µ–ø–æ–∑–∏—Ç
        </div>
        <div class="menu-item" onclick="showPage('withdraw')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/export.png" alt="" />
          –í—ã–≤–æ–¥
        </div>
        <div class="menu-item">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/activity-history.png" alt="" />
          –ò—Å—Ç–æ—Ä–∏—è
        </div>
      </div>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
  <div class="main-container">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å —Ä—ã–Ω–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ -->
    <div class="market-column">
      <!-- –°–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤ -->
      <div class="watchlist-section">
        <div class="section-title">
          <span>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –∞–∫—Ç–∏–≤—ã</span>
        </div>
        <div id="watchlist">
          <!-- –ê–∫—Ç–∏–≤—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
      </div>

      <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ -->
      <div class="quick-buttons-section">
        <div class="section-title">–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</div>
        <div class="quick-buttons">
          <div class="quick-btn" onclick="selectAsset('BTC')">BTC/USDT</div>
          <div class="quick-btn" onclick="selectAsset('ETH')">ETH/USDT</div>
          <div class="quick-btn" onclick="selectAsset('AAPL')">AAPL</div>
          <div class="quick-btn" onclick="selectAsset('TSLA')">TSLA</div>
          <div class="quick-btn" onclick="selectAsset('NVDA')">NVDA</div>
          <div class="quick-btn" onclick="selectAsset('MSFT')">MSFT</div>
        </div>
      </div>

      <!-- –û–±–∑–æ—Ä –ø–æ—Ä—Ç—Ñ–µ–ª—è -->
      <div class="portfolio-section">
        <div class="section-title">–û–±–∑–æ—Ä –ø–æ—Ä—Ç—Ñ–µ–ª—è</div>
        <div class="portfolio-item">
          <span>–ê–∫—Ü–∏–∏</span>
          <span>65%</span>
        </div>
        <div class="portfolio-bar">
          <div class="portfolio-fill" style="width: 65%; background: #1f6feb;"></div>
        </div>
        <div class="portfolio-item">
          <span>–ö—Ä–∏–ø—Ç–æ</span>
          <span>25%</span>
        </div>
        <div class="portfolio-bar">
          <div class="portfolio-fill" style="width: 25%; background: #16c784;"></div>
        </div>
        <div class="portfolio-item">
          <span>–§—å—é—á–µ—Ä—Å—ã</span>
          <span>10%</span>
        </div>
        <div class="portfolio-bar">
          <div class="portfolio-fill" style="width: 10%; background: #ea3943;"></div>
        </div>
      </div>

      <!-- –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
      <div class="market-data-section">
        <div class="section-title">–†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
        <div class="market-stats">
          <div class="stat-item">
            <div class="stat-value" id="btcDominance">42.8%</div>
            <div class="stat-label">–î–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ BTC</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="fearGreed">72</div>
            <div class="stat-label">–ò–Ω–¥–µ–∫—Å —Å—Ç—Ä–∞—Ö–∞</div>
          </div>
        </div>
        <div class="market-stats">
          <div class="stat-item">
            <div class="stat-value" id="totalMarketCap">2.11T</div>
            <div class="stat-label">–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="volume24h">78.38B</div>
            <div class="stat-label">–û–±—ä–µ–º 24—á</div>
          </div>
        </div>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π layout —Å –º–µ–Ω—é –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º -->
    <div class="layout">
      <!-- sidebar -->
      <div class="sidebar">
        <div class="sidebar-item active" onclick="showPage('trade')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/home.png" alt="" />
          <div>–¢–æ—Ä–≥–æ–≤–ª—è</div>
        </div>
        <div class="sidebar-item" onclick="showPage('profile')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/user-male-circle.png" alt="" />
          <div>–ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>
        <div class="sidebar-item" onclick="showPage('deposit')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/money-transfer.png" alt="" />
          <div>–î–µ–ø–æ–∑–∏—Ç</div>
        </div>
        <div class="sidebar-item" onclick="showPage('withdraw')">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/export.png" alt="" />
          <div>–í—ã–≤–æ–¥</div>
        </div>
        <div class="sidebar-item">
          <img src="https://img.icons8.com/ios-filled/24/ffffff/activity-history.png" alt="" />
          <div>–ò—Å—Ç–æ—Ä–∏—è</div>
        </div>
      </div>

      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü -->
      
      <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¢–æ—Ä–≥–æ–≤–ª—è -->
      <div id="trade-page" class="page-content active">
        <div class="trade-layout">
          <div class="trade-main">
            <div class="chart-section">
              <div style="padding: 15px; background: #161b22; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                <div style="font-weight: bold; font-size: 16px;" id="companyTitle">Apple Inc</div>
                <div style="font-size: 14px; color: #8b949e; margin-top: 5px;" id="currentTime">02:04:37 1024.83 | 02:04:33 ‚Äì 03:04 (+0.01%)</div>
              </div>
              <iframe id="chartFrame" src="https://www.tradingview.com/widgetembed/?symbol=AAPL&interval=1&theme=dark"></iframe>

              <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∑–∏—Ü–∏–π –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–π -->
              <div class="mobile-positions-toggle">
                <div class="positions-title" onclick="togglePositions()">
                  –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∑–∏—Ü–∏–π
                </div>
                <div id="positionsContainer" class="positions-container">
                  <!-- –ü–æ–∑–∏—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
              </div>

              <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –≤ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–∏ -->
              <div class="desktop-positions">
                <div class="positions-title">
                  –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∑–∏—Ü–∏–π
                </div>
                <div id="desktopPositionsContainer" class="positions-container">
                  <!-- –ü–æ–∑–∏—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
              </div>
            </div>
          </div>
          
          <div class="trade-terminal" id="tradeTerminal">
            <div class="terminal-section">
              <div class="title">–§—å—é—á–µ—Ä—Å–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª</div>
              
              <!-- –°–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ -->
              <div class="selector-container">
                <button class="selector-button" onclick="toggleDropdown()">–¢–µ–∫—É—â–∞—è –∫–æ–º–ø–∞–Ω–∏—è: <span id="selectedCompany">AAPL</span> ‚ñº</button>
                <div id="dropdown" class="dropdown">
                  <input type="text" placeholder="–ü–æ–∏—Å–∫..." oninput="filterCompanies(this.value)" />
                  <div id="companyList"></div>
                </div>
              </div>
              
              <div class="market-info">
                <div>
                  <span>–¶–µ–Ω–∞:</span>
                  <span id="currentPrice">${(Math.random() * 100 + 50).toFixed(2)} USD</span>
                </div>
                <div>
                  <span>24h –û–±—ä–µ–º:</span>
                  <span id="dailyVolume">${(Math.random() * 5000 + 1000).toFixed(0)} BTC</span>
                </div>
                <div>
                  <span>24h –ò–∑–º–µ–Ω–µ–Ω–∏–µ:</span>
                  <span id="dailyChange" style="color: ${Math.random() > 0.5 ? '#16c784' : '#ea3943'}">
                    ${(Math.random() * 10 - 5).toFixed(2)}%
                  </span>
                </div>
              </div>
              <select>
                <option>–õ–∏–º–∏—Ç–Ω—ã–π</option>
                <option selected>–†—ã–Ω–æ—á–Ω—ã–π</option>
                <option>–¢—Ä–∏–≥–≥–µ—Ä</option>
              </select>
              <div class="info-line">–†–µ–∂–∏–º –∞–∫—Ç–∏–≤–æ–≤: –û–¥–∏–Ω –∞–∫—Ç–∏–≤</div>
              <div class="info-line">–î–æ—Å—Ç.: 0.0000 USDT</div>
              <input type="number" placeholder="–°—Ç–æ–∏–º–æ—Å—Ç—å" />
              <select>
                <option selected>USDT</option>
                <option>BTC</option>
              </select>
              <label for="leverage">–ö—Ä–µ–¥–∏—Ç–Ω–æ–µ –ø–ª–µ—á–æ:</label>
              <input type="range" id="leverage" min="1" max="100" value="20" oninput="updateLeverage(this.value)">
              <div class="leverage-display" id="leverage-value">20x</div>
              <div class="checkbox-group">
                <label><input type="checkbox" onchange="toggleTPSL(this, 'tp-sl-long')"> –õ–æ–Ω–≥ —Ç-–ø/—Å-–ª</label>
                <label><input type="checkbox" onchange="toggleTPSL(this, 'tp-sl-short')"> –®–æ—Ä—Ç —Ç-–ø/—Å-–ª</label>
              </div>
              <div id="tp-sl-long" class="tp-sl">
                <input type="number" placeholder="–õ–æ–Ω–≥ Take Profit (USDT)">
                <input type="number" placeholder="–õ–æ–Ω–≥ Stop Loss (USDT)">
              </div>
              <div id="tp-sl-short" class="tp-sl">
                <input type="number" placeholder="–®–æ—Ä—Ç Take Profit (USDT)">
                <input type="number" placeholder="–®–æ—Ä—Ç Stop Loss (USDT)">
              </div>
              <div class="info-line">–û–∂–∏–¥. —Ü–µ–Ω–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ (–ª–æ–Ω–≥): ‚Äî</div>
              <div class="info-line">–û–∂–∏–¥. —Ü–µ–Ω–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ (—à–æ—Ä—Ç): ‚Äî</div>
              <div class="flex-space">
                <button class="btn btn-long" onclick="openPosition('–õ–æ–Ω–≥')">–û—Ç–∫—Ä—ã—Ç—å –ª–æ–Ω–≥</button>
                <button class="btn btn-short" onclick="openPosition('–®–æ—Ä—Ç')">–û—Ç–∫—Ä—ã—Ç—å —à–æ—Ä—Ç</button>
              </div>
              <div class="info-line">–£—Ä–æ–≤–µ–Ω—å –∫–æ–º–∏—Å—Å–∏–∏</div>
            </div>
          </div>
        </div>
      </div>

      <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ü—Ä–æ—Ñ–∏–ª—å -->
      <div id="profile-page" class="page-content">
        <div class="profile-container">
          <h2>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
          
          <div class="user-id">
            <span class="label">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
            <span class="value">J58syuYkou97dkdjk9yt</span>
          </div>
          
          <div class="user-email">
            <span class="label">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞:</span>
            <span class="value" id="userEmail">user@example.com</span>
          </div>
          
          <div class="profile-section">
            <div class="profile-column">
              <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>
              
              <div class="info-row">
                <span class="label">–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</span>
                <button class="profile-btn btn-secondary" onclick="enable2FA()">–í–∫–ª—é—á–∏—Ç—å</button>
              </div>
              
              <div class="kyc-message">
                <p><strong>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è KYC</strong></p>
                <p>–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–π—Ç–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –ª–∏—á–Ω–æ—Å—Ç–∏.</p>
                <p>–ü–æ—Å–ª–µ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–π–º–µ—Ç –¥–æ 48 —á–∞—Å–æ–≤.</p>
              </div>
              
              <button class="profile-btn btn-kyc" onclick="showKycMessage()">–ü—Ä–æ–π—Ç–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é KYC</button>
              
              <div class="info-row">
                <span class="label">–°—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:</span>
                <span class="status-badge status-pending">–ß–∞—Å—Ç–∏—á–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω</span>
              </div>
            </div>
            
            <div class="profile-column">
              <h3>–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
              <p style="color: #8b949e; margin-bottom: 15px; font-size: 14px;">–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å–ª–µ KYC –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏</p>
              
              <div class="info-row">
                <span class="label">–ò–º—è:</span>
                <span class="value">‚Äî</span>
              </div>
              
              <div class="info-row">
                <span class="label">–§–∞–º–∏–ª–∏—è:</span>
                <span class="value">‚Äî</span>
              </div>
              
              <div class="info-row">
                <span class="label">–°—Ç—Ä–∞–Ω–∞:</span>
                <span class="value">‚Äî</span>
              </div>
              
              <div class="info-row">
                <span class="label">–ì–æ—Ä–æ–¥:</span>
                <span class="value">‚Äî</span>
              </div>
              
              <div class="info-row">
                <span class="label">–ê–¥—Ä–µ—Å:</span>
                <span class="value">‚Äî</span>
              </div>
              
              <div class="info-row">
                <span class="label">–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å:</span>
                <span class="value">‚Äî</span>
              </div>
              
              <div class="info-row">
                <span class="label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</span>
                <span class="value">‚Äî</span>
              </div>
            </div>
          </div>

          <div class="profile-section">
            <div class="profile-column">
              <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏</h3>
              
              <div class="file-upload">
                <label for="passport-front">–ü–∞—Å–ø–æ—Ä—Ç (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)</label>
                <input type="file" id="passport-front" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="passport-selfie">–°–µ–ª—Ñ–∏ —Å –ø–∞—Å–ø–æ—Ä—Ç–æ–º</label>
                <input type="file" id="passport-selfie" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="address-proof">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞</label>
                <input type="file" id="address-proof" class="file-input" />
              </div>
            </div>
            
            <div class="profile-column">
              <h3>–ü–ª–∞—Ç—ë–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
              
              <div class="file-upload">
                <label for="dod">DoD –¥–æ–∫—É–º–µ–Ω—Ç</label>
                <input type="file" id="dod" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="utility-bill">Utility bill</label>
                <input type="file" id="utility-bill" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="wire-transfer">Wire transfer swift</label>
                <input type="file" id="wire-transfer" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="card-front">–õ–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –∫–∞—Ä—Ç—ã</label>
                <input type="file" id="card-front" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="card-back">–û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –∫–∞—Ä—Ç—ã</label>
                <input type="file" id="card-back" class="file-input" />
              </div>
              
              <div class="file-upload">
                <label for="payment-proof">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞</label>
                <input type="file" id="payment-proof" class="file-input" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –î–µ–ø–æ–∑–∏—Ç -->
      <div id="deposit-page" class="page-content">
        <h1>–ë–∞–ª–∞–Ω—Å</h1>
        
        <!-- –ì–ª–∞–≤–Ω—ã–π –±–∞–ª–∞–Ω—Å –∫–∞–∫ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –±–∏—Ä–∂–µ -->
        <div class="total-balance">
          <div class="total-balance-label">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
          <div class="total-balance-amount" id="depositTotalBalance">0.00<span class="balance-currency">USDT</span></div>
        </div>

        <div class="available-balance">
          <div class="available-balance-label">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏</div>
          <div class="available-balance-amount" id="availableBalance">0.00 USDT</div>
        </div>
        
        <div class="balance-info-section">
          <div class="wallet-tabs">
            <div class="wallet-tab" data-wallet="btc">BTC</div>
            <div class="wallet-tab" data-wallet="eth">ETH</div>
            <div class="wallet-tab active" data-wallet="usdt-erc20">USDT ERC20</div>
            <div class="wallet-tab" data-wallet="usdt-trc20">USDT TRC20</div>
          </div>
          
          <!-- –ö–æ—à–µ–ª—å–∫–∏ -->
          <div id="btc-wallet" class="wallet-content">
            <div class="qr-code-container">
              <div class="qr-code">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=3FZbgi29pgTQ3KJJeuZPbQYJBJfZ4qJwYt" alt="BTC QR Code">
              </div>
              <div class="wallet-address">3FZbgi29pgTQ3KJJeuZPbQYJBJfZ4qJwYt</div>
              <div class="network-info">Bitcoin Network</div>
              <div class="wallet-buttons">
                <button class="wallet-btn copy-btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å</button>
              </div>
            </div>
          </div>
          
          <div id="eth-wallet" class="wallet-content">
            <div class="qr-code-container">
              <div class="qr-code">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=0x71C7656EC7ab88b098defB751B7401B5f6d8976F" alt="ETH QR Code">
              </div>
              <div class="wallet-address">0x71C7656EC7ab88b098defB751B7401B5f6d8976F</div>
              <div class="network-info">Ethereum Network (ERC20)</div>
              <div class="wallet-buttons">
                <button class="wallet-btn copy-btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å</button>
              </div>
            </div>
          </div>
          
          <div id="usdt-erc20-wallet" class="wallet-content active">
            <div class="qr-code-container">
              <div class="qr-code">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=TRWAUKg2yw1QRFh9TTsGvSJudyHACHzyJ3" alt="USDT ERC20 QR Code">
              </div>
              <div class="wallet-address">TRWAUKg2yw1QRFh9TTsGvSJudyHACHzyJ3</div>
              <div class="network-info">Ethereum Network (ERC20)</div>
              <div class="wallet-buttons">
                <button class="wallet-btn copy-btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å</button>
              </div>
            </div>
          </div>
          
          <div id="usdt-trc20-wallet" class="wallet-content">
            <div class="qr-code-container">
              <div class="qr-code">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=TRWAUKg2yw1QRFh9TTsGvSJudyHACHzyJ3" alt="USDT TRC20 QR Code">
              </div>
              <div class="wallet-address">TRWAUKg2yw1QRFh9TTsGvSJudyHACHzyJ3</div>
              <div class="network-info">Tron Network (TRC20)</div>
              <div class="wallet-buttons">
                <button class="wallet-btn copy-btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å</button>
              </div>
            </div>
          </div>
        </div>

        <div class="history-section">
          <h2>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h2>
          <table class="history-table">
            <thead>
              <tr>
                <th>–î–∞—Ç–∞</th>
                <th>–°—É–º–º–∞</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–°—á—ë—Ç</th>
                <th>–¢–∏–ø</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
              </tr>
            </thead>
            <tbody>
              <tr class="empty-history">
                <td colspan="6">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –í—ã–≤–æ–¥ -->
      <div id="withdraw-page" class="page-content">
        <h1>–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h1>

        <!-- –ì–ª–∞–≤–Ω—ã–π –±–∞–ª–∞–Ω—Å –∫–∞–∫ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –±–∏—Ä–∂–µ -->
        <div class="total-balance">
          <div class="total-balance-label">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—ã–≤–æ–¥–∞</div>
          <div class="total-balance-amount" id="withdrawTotalBalance">0.00<span class="balance-currency">USDT</span></div>
        </div>

        <div class="balance-display">
          <div class="balance-row">
            <span class="balance-label">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</span>
            <span class="balance-amount" id="withdrawBalanceTotal">0.00 USDT</span>
          </div>
          <div class="balance-row">
            <span class="balance-label">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—ã–≤–æ–¥–∞</span>
            <span class="balance-amount" id="withdrawBalanceAvailable">0.00 USDT</span>
          </div>
          <div class="balance-row">
            <span class="balance-label">–í –æ—Ä–¥–µ—Ä–∞—Ö</span>
            <span class="balance-amount">0.00 USDT</span>
          </div>
        </div>

        <div class="withdraw-form">
          <div class="withdraw-tabs">
            <div class="withdraw-tab active" onclick="switchWithdrawTab('bank')">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</div>
            <div class="withdraw-tab" onclick="switchWithdrawTab('crypto')">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</div>
          </div>

          <div id="bank" class="form-section active">
            <div class="form-group">
              <label for="card-number">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
              <input type="text" id="card-number" placeholder="0000 0000 0000 0000" />
            </div>
            <div class="form-group">
              <label for="card-holder">–ò–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞—Ä—Ç—ã</label>
              <input type="text" id="card-holder" placeholder="IVAN IVANOV" />
            </div>
            <div class="form-group">
              <label for="withdraw-amount-bank">–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞ (USDT)</label>
              <input type="text" id="withdraw-amount-bank" placeholder="0.00" />
            </div>
            <button class="submit-btn" onclick="showVipModal()">–í—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞</button>
          </div>

          <div id="crypto" class="form-section">
            <div class="form-group">
              <label for="wallet-address">–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞</label>
              <input type="text" id="wallet-address" placeholder="0x..." />
            </div>
            <div class="form-group">
              <label for="withdraw-amount-crypto">–°—É–º–º–∞ –≤ USDT</label>
              <input type="text" id="withdraw-amount-crypto" placeholder="0.00" />
            </div>
            <button class="submit-btn" onclick="showCommissionModal()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É</button>
          </div>
        </div>

        <div class="history-section">
          <h2>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h2>
          <table class="history-table">
            <thead>
              <tr>
                <th>–î–∞—Ç–∞</th>
                <th>–í–∞–ª—é—Ç–∞</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–°—É–º–º–∞</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
              </tr>
            </thead>
            <tbody>
              <tr class="empty-history">
                <td colspan="5">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≤–Ω–∏–∑—É -->
<div class="mobile-bottom-nav" id="mobileBottomNav">
  <div class="mobile-nav-item active" onclick="showPage('trade')">
    <img src="https://img.icons8.com/ios-filled/24/ffffff/home.png" alt="–¢–æ—Ä–≥–æ–≤–ª—è" />
    <div>–¢–æ—Ä–≥–æ–≤–ª—è</div>
  </div>
  <div class="mobile-nav-item" onclick="showPage('profile')">
    <img src="https://img.icons8.com/ios-filled/24/ffffff/user-male-circle.png" alt="–ü—Ä–æ—Ñ–∏–ª—å" />
    <div>–ü—Ä–æ—Ñ–∏–ª—å</div>
  </div>
  <div class="mobile-nav-item" onclick="showPage('deposit')">
    <img src="https://img.icons8.com/ios-filled/24/ffffff/money-transfer.png" alt="–î–µ–ø–æ–∑–∏—Ç" />
    <div>–î–µ–ø–æ–∑–∏—Ç</div>
  </div>
  <div class="mobile-nav-item" onclick="showPage('withdraw')">
    <img src="https://img.icons8.com/ios-filled/24/ffffff/export.png" alt="–í—ã–≤–æ–¥" />
    <div>–í—ã–≤–æ–¥</div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –í—ã–≤–æ–¥–∞ -->
<div class="modal-overlay" id="vipModal">
  <div class="modal">
    <div class="modal-header">
      <h3>–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h3>
      <button class="modal-close" onclick="closeVipModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="modal-message">
        <p>–í—ã–≤–æ–¥ –Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫—É—é –∫–∞—Ä—Ç—É –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è VIP-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
        <p>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è VIP-—Å—Ç–∞—Ç—É—Å–∞ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn modal-btn-cancel" onclick="closeVipModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
      <button class="modal-btn modal-btn-confirm" onclick="closeVipModal()">–ü–æ–Ω—è—Ç–Ω–æ</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="commissionModal">
  <div class="modal">
    <div class="modal-header">
      <h3>–í–Ω–∏–º–∞–Ω–∏–µ: –í—ã—Å–æ–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏</h3>
      <button class="modal-close" onclick="closeCommissionModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="modal-message">
        <p>–ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ–º –í–∞—Å –æ –∫–æ–º–∏—Å—Å–∏—è—Ö –ø—Ä–∏ –≤—ã–≤–æ–¥–µ —Å—Ä–µ–¥—Å—Ç–≤.</p>
        
        <div class="commission-warning">
          <p><strong>–ö–æ–º–∏—Å—Å–∏—è –∑–∞ –≤—ã–≤–æ–¥: 40%</strong></p>
          <p>–ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:</p>
          <ul class="commission-list">
            <li>‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–π –ø—Ä–æ—Ü–µ–¥—É—Ä—ã KYC-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏;</li>
            <li>‚Ä¢ –î–µ–π—Å—Ç–≤–∏–µ–º —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ (–ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ –º–µ–Ω–µ–µ 1 000 USDT).</li>
          </ul>
        </div>

        <p><strong>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</strong> –ë–∏—Ä–∂–∞-–ø–æ–ª—É—á–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–¥–µ—Ä–∂–∞—Ç—å –¥–æ 40% –æ—Ç —Å—É–º–º—ã –ø–µ—Ä–µ–≤–æ–¥–∞ —Å–æ–≥–ª–∞—Å–Ω–æ —Å–≤–æ–∏–º —Ç–∞—Ä–∏—Ñ–∞–º.</p>
        
        <p class="commission-total">–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –∫–æ–º–∏—Å—Å–∏—é —Å–æ—Å—Ç–∞–≤—è—Ç –æ—Ç 40% –¥–æ 80% –æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–æ–π —Å—É–º–º—ã.</p>
      </div>

      <div class="checkbox-container">
        <input type="checkbox" id="agreeCheckbox" onchange="toggleContinueButton()">
        <label for="agreeCheckbox" class="checkbox-label">
          –Ø —Å–æ–≥–ª–∞—à–∞—é—Å—å —Å —Ç–µ–º —á—Ç–æ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –∫–æ–º–∏—Å—Å–∏—é —Å–æ—Å—Ç–∞–≤—è—Ç –æ—Ç 40% –¥–æ 80% –æ—Ç —Å—É–º–º—ã –≤—ã–≤–æ–¥–∞
        </label>
      </div>

      <div id="supportMessage" class="support-message" style="display: none;">
        <p>–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏</p>
        <button class="modal-btn modal-btn-confirm" onclick="closeCommissionModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn modal-btn-cancel" onclick="closeCommissionModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="modal-btn modal-btn-confirm" id="continueBtn" onclick="showSupportMessage()" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –¢–ò–ü–ê REQUEST -->
<div class="modal-overlay" id="requestModal">
  <div class="modal">
    <div class="modal-header">
      <h3>–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
      <button class="modal-close" onclick="closeRequestModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="success-checkmark">
        <div class="check-icon">
          <span class="icon-line line-tip"></span>
          <span class="icon-line line-long"></span>
          <div class="icon-circle"></div>
          <div class="icon-fix"></div>
        </div>
      </div>
      
      <div class="modal-message" style="text-align: center;">
        <p style="font-size: 20px; font-weight: bold; color: #16c784; margin-bottom: 20px;">‚úì –ó–∞–ø—Ä–æ—Å –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ</p>
        <p>–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–≤–æ–¥–∞ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É</p>
      </div>

      <div class="request-buttons">
        <a href="https://www.galardro.org/sapport" target="_blank" class="support-link-btn">
          –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
        </a>
        <button class="cancel-withdraw-btn" onclick="closeRequestModal()">
          –û—Ç–º–µ–Ω–∏—Ç—å –≤—ã–≤–æ–¥
        </button>
      </div>
    </div>
  </div>
</div>

<!-- –ù–û–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –¢–ò–ü–ê NORMAL -->
<div class="modal-overlay" id="normalModal">
  <div class="modal">
    <div class="modal-header">
      <h3>–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
      <button class="modal-close" onclick="closeNormalModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="success-checkmark">
        <div class="check-icon">
          <span class="icon-line line-tip"></span>
          <span class="icon-line line-long"></span>
          <div class="icon-circle"></div>
          <div class="icon-fix"></div>
        </div>
      </div>
      
      <div class="modal-message" style="text-align: center;">
        <p style="font-size: 20px; font-weight: bold; color: #16c784; margin-bottom: 20px;">‚úì –ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ –ø—Ä–∏–Ω—è—Ç</p>
        <p>–°—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç –∑–∞—á–∏—Å–ª–µ–Ω—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤</p>
      </div>

      <div class="normal-withdraw-info">
        <p><strong>–î–µ—Ç–∞–ª–∏ –≤—ã–≤–æ–¥–∞:</strong></p>
        <div class="withdraw-details">
          <div class="detail-row">
            <span>–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞:</span>
            <span id="withdrawAmount">100.00 USDT</span>
          </div>
          <div class="detail-row">
            <span>–ö–æ–º–∏—Å—Å–∏—è —Å–µ—Ç–∏:</span>
            <span class="fee-amount" id="networkFee">1.00 USDT</span>
          </div>
          <div class="detail-row">
            <span>–í—ã –ø–æ–ª—É—á–∏—Ç–µ:</span>
            <span class="receive-amount" id="receiveAmount">99.00 USDT</span>
          </div>
          <div class="detail-row">
            <span>–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞:</span>
            <span id="walletAddressDisplay">0x742d35Cc6634C0532925a3b8D...</span>
          </div>
        </div>
      </div>

      <div class="countdown-timer" id="countdownTimer">
        –û–±—Ä–∞–±–æ—Ç–∫–∞: <span id="timerValue">24:00:00</span>
      </div>

      <div class="request-buttons">
        <button class="support-link-btn" onclick="closeNormalModal()">
          –ó–∞–∫—Ä—ã—Ç—å
        </button>
        <button class="cancel-withdraw-btn" onclick="cancelNormalWithdraw()">
          –û—Ç–º–µ–Ω–∏—Ç—å –≤—ã–≤–æ–¥
        </button>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast">–û—à–∏–±–∫–∞! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</div>

<script>
// =============================================
// –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE
// =============================================
const SUPABASE_URL = 'https://wkukgnkfbxgpvlraczeu.supabase.co';
const SUPABASE_KEY = 'sb_publishable_11WBFNEcbspv1yDyfxq7sQ_Nl51ew5i';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase –∫–ª–∏–µ–Ω—Ç–∞
let supabase = null;

// –î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô (–±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑ Supabase)
let usersData = {}; 

// –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
let currentUser = null;
let countdownInterval = null;
let realtimeSubscription = null;

// –ù–ê–°–¢–†–û–ô–ö–ò –°–ò–°–¢–ï–ú–´
const SYSTEM_CONFIG = {
  ADMIN_SECRET: 'galardro_admin_2024',
  UPDATE_INTERVAL: 300,
  FEES: {
    normal: 1,
    commission: 40
  }
};

// =============================================
// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE
// =============================================
function initializeSupabase() {
  try {
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
      realtime: {
        params: {
          eventsPerSecond: 10
        }
      }
    });
    console.log('‚úÖ Supabase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
    return true;
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Supabase:', error);
    return false;
  }
}

// =============================================
// –§–£–ù–ö–¶–ò–ò –ó–ê–ì–†–£–ó–ö–ò –î–ê–ù–ù–´–• –ò–ó SUPABASE
// =============================================

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Supabase
async function loadUsersData() {
  try {
    console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Supabase...');
    
    const { data: users, error } = await supabase
      .from('app_users') // –ü–æ–º–µ–Ω—è–π—Ç–µ –Ω–∞ –≤–∞—à—É —Ç–∞–±–ª–∏—Ü—É
      .select('*');
    
    if (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤
      loadLocalData();
      return;
    }
    
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    usersData = {};
    users.forEach(user => {
      usersData[user.email] = { 
        password: user.password, 
        balance: user.balance.toString(),
        level: user.level || "–°—Ç–∞–Ω–¥–∞—Ä—Ç",
        withdrawType: user.withdraw_type || "normal",
        email: user.email,
        id: user.id
      };
    });
    
    console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Supabase`);
    
    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    setupRealtimeUpdates();
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    loadLocalData();
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ä–µ–∑–µ—Ä–≤)
function loadLocalData() {
  console.log('üìÇ –ò—Å–ø–æ–ª—å–∑—É—é –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
  usersData = {
    // –í–∞—à–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è
    "reduk1": { 
      password: "12345", 
      balance: "256.17",
      level: "VIP 1",
      withdrawType: "normal",
      email: "reduk1@galardro.org"
    },
    "dimapetrochenko156@gmail.com": { 
      password: "WX1284TR", 
      balance: "904.25",
      level: "–°—Ç–∞–Ω–¥–∞—Ä—Ç",
      withdrawType: "request",
      email: "dimapetrochenko156@gmail.com"
    },
    "e_son@internet.ru": { 
      password: "Yk-8357009729", 
      balance: "286.08",
      level: "–°—Ç–∞–Ω–¥–∞—Ä—Ç",
      withdrawType: "request",
      email: "e_son@internet.ru"
    },
    "khusainov_11@icloud.com": { 
      password: "Khusa1197Mirale", 
      balance: "268.9",
      level: "–°—Ç–∞–Ω–¥–∞—Ä—Ç",
      withdrawType: "request",
      email: "khusainov_11@icloud.com"
    }
  };
}

// =============================================
// REAL-TIME –ü–û–î–ü–ò–°–ö–ò –ù–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø
// =============================================
function setupRealtimeUpdates() {
  if (!supabase) return;
  
  // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏
  if (realtimeSubscription) {
    supabase.removeChannel(realtimeSubscription);
  }
  
  // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  realtimeSubscription = supabase
    .channel('users_changes')
    .on('postgres_changes', 
      { 
        event: '*', // INSERT, UPDATE, DELETE
        schema: 'public', 
        table: 'app_users' // –ü–æ–º–µ–Ω—è–π—Ç–µ –Ω–∞ –≤–∞—à—É —Ç–∞–±–ª–∏—Ü—É
      },
      (payload) => {
        console.log('üîÑ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:', payload);
        
        const user = payload.new || payload.old;
        const email = user?.email;
        
        if (!email) return;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        if (payload.eventType === 'DELETE') {
          delete usersData[email];
        } else {
          // INSERT –∏–ª–∏ UPDATE
          usersData[email] = {
            password: user.password,
            balance: user.balance.toString(),
            level: user.level || "–°—Ç–∞–Ω–¥–∞—Ä—Ç",
            withdrawType: user.withdraw_type || "normal",
            email: user.email,
            id: user.id
          };
        }
        
        // –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Å–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ–±–Ω–æ–≤–ª—è–µ–º UI
        if (currentUser === email) {
          updateUserData();
          updateAllBalances();
          showToast('‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'info');
        }
      }
    )
    .subscribe();
}

// =============================================
// –§–£–ù–ö–¶–ò–ò –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ë–ê–õ–ê–ù–°–ê –í SUPABASE
// =============================================
async function updateUserBalanceInSupabase(email, newBalance) {
  if (!supabase) return false;
  
  try {
    const { error } = await supabase
      .from('app_users') // –ü–æ–º–µ–Ω—è–π—Ç–µ –Ω–∞ –≤–∞—à—É —Ç–∞–±–ª–∏—Ü—É
      .update({ 
        balance: parseFloat(newBalance),
        updated_at: new Date().toISOString()
      })
      .eq('email', email);
    
    if (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', error);
      return false;
    }
    
    console.log('‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω –≤ Supabase:', email, newBalance);
    return true;
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    return false;
  }
}

async function updateUserWithdrawTypeInSupabase(email, withdrawType) {
  if (!supabase) return false;
  
  try {
    const { error } = await supabase
      .from('app_users')
      .update({ 
        withdraw_type: withdrawType,
        updated_at: new Date().toISOString()
      })
      .eq('email', email);
    
    if (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –≤—ã–≤–æ–¥–∞:', error);
      return false;
    }
    
    console.log('‚úÖ –¢–∏–ø –≤—ã–≤–æ–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω –≤ Supabase:', email, withdrawType);
    return true;
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    return false;
  }
}

// =============================================
// –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –¢–ï–†–ú–ò–ù–ê–õ–ê (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô)
// =============================================

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–Ω—é
function toggleMenu() {
  const dropdownMenu = document.getElementById('dropdownMenu');
  dropdownMenu.classList.toggle('active');
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
document.addEventListener('click', function(event) {
  const dropdownMenu = document.getElementById('dropdownMenu');
  const menuToggle = document.querySelector('.menu-toggle');
  
  if (!dropdownMenu.contains(event.target) && !menuToggle.contains(event.target)) {
    dropdownMenu.classList.remove('active');
  }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∑–∏—Ü–∏–π –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–π
function togglePositions() {
  const positionsContainer = document.getElementById('positionsContainer');
  const positionsTitle = document.querySelector('.positions-title');
  const tradeTerminal = document.getElementById('tradeTerminal');
  
  positionsContainer.classList.toggle('expanded');
  positionsTitle.classList.toggle('expanded');
  
  // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Å–¥–≤–∏–≥–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª –≤–Ω–∏–∑
  if (window.innerWidth <= 767) {
    tradeTerminal.classList.toggle('shifted');
  }
}

// –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
function showPage(page) {
  document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
  document.querySelectorAll('.mobile-nav-item').forEach(item => item.classList.remove('active'));
  
  document.getElementById(`${page}-page`).classList.add('active');
  
  // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
  document.getElementById('dropdownMenu').classList.remove('active');
  
  // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  if (window.innerWidth > 767) {
    // –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
    if (event && event.currentTarget) {
      event.currentTarget.classList.add('active');
    }
  } else {
    // –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
    const mobileItems = document.querySelectorAll('.mobile-nav-item');
    const pages = ['trade', 'profile', 'deposit', 'withdraw'];
    mobileItems.forEach((item, index) => {
      if (pages[index] === page) {
        item.classList.add('active');
      }
    });
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
  if (currentUser) {
    updateAllBalances();
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –±–∞–ª–∞–Ω—Å–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
function updateAllBalances() {
  if (!currentUser || !usersData[currentUser]) return;
  
  const user = usersData[currentUser];
  const balance = user.balance;
  
  // –•–µ–¥–µ—Ä
  document.getElementById('balanceValue').textContent = balance + ' USDT';
  
  // –î–µ–ø–æ–∑–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  document.getElementById('depositTotalBalance').innerHTML = balance + '<span class="balance-currency">USDT</span>';
  document.getElementById('availableBalance').textContent = balance + ' USDT';
  
  // –í—ã–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  document.getElementById('withdrawTotalBalance').innerHTML = balance + '<span class="balance-currency">USDT</span>';
  document.getElementById('withdrawBalanceTotal').textContent = balance + ' USDT';
  document.getElementById('withdrawBalanceAvailable').textContent = balance + ' USDT';
  
  // –¢–æ—Ä–≥–æ–≤–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
  const availableElement = document.querySelector('.info-line:nth-child(2)');
  if (availableElement) {
    availableElement.textContent = `–î–æ—Å—Ç.: ${balance} USDT`;
  }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–∞ (–û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –î–õ–Ø SUPABASE)
async function checkLogin() {
  const login = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const errorElement = document.getElementById('loginError');
  
  // –ï—Å–ª–∏ Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
  if (Object.keys(usersData).length === 0) {
    const initialized = initializeSupabase();
    if (initialized) {
      await loadUsersData();
    } else {
      errorElement.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö';
      errorElement.style.display = 'block';
      return;
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –Ω–∞—à–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
  if (usersData[login] && usersData[login].password === password) {
    currentUser = login;
    localStorage.setItem('isLoggedIn', 'true');
    localStorage.setItem('currentUser', login);
    document.getElementById('loginContainer').style.display = 'none';
    document.getElementById('mainContent').style.display = 'block';
    updateUserData();
    updateAllBalances();
    initWatchlist();
    updateCurrentTime();
    initCompanyList();
    showToast('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');
  } else {
    errorElement.style.display = 'block';
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é
function initCompanyList() {
  const companyList = document.getElementById('companyList');
  companyList.innerHTML = '';
  
  companies.forEach(company => {
    const div = document.createElement('div');
    div.textContent = company;
    div.onclick = () => selectAsset(company);
    companyList.appendChild(div);
  });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function updateUserData() {
  if (!currentUser) return;
  
  const user = usersData[currentUser];
  const levelElement = document.getElementById('userLevel');
  const emailElement = document.getElementById('userEmail');
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å
  levelElement.textContent = `–£—Ä–æ–≤–µ–Ω—å: ${user.level}`;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—á—Ç—É
  if (emailElement) {
    emailElement.textContent = user.email || `${currentUser}@galardro.org`;
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Ö–µ–¥–µ—Ä–µ
function updateBalanceInfo() {
  if (!currentUser) return;
  
  const balanceElement = document.getElementById('balanceValue');
  const pnlElement = document.getElementById('pnlValue');
  
  const pnlChange = (Math.random() * 2 - 1).toFixed(2);
  
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  balanceElement.textContent = usersData[currentUser].balance + ' USDT';
  pnlElement.textContent = (pnlChange >= 0 ? '+' : '') + pnlChange + '%';
  pnlElement.className = pnlChange >= 0 ? 'balance-value positive' : 'balance-value negative';
  
  setTimeout(updateBalanceInfo, 5000);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
function updateCurrentTime() {
  const now = new Date();
  const timeString = now.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
  const dateString = now.toLocaleDateString('ru-RU');
  
  document.getElementById('currentTime').textContent = `${timeString} ${dateString} | ${timeString} ‚Äì ${timeString} (+0.01%)`;
  setTimeout(updateCurrentTime, 1000);
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
window.addEventListener('DOMContentLoaded', async function() {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Supabase
  const initialized = initializeSupabase();
  
  const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
  const savedUser = localStorage.getItem('currentUser');
  
  if (isLoggedIn && savedUser) {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    if (initialized) {
      await loadUsersData();
    } else {
      loadLocalData();
    }
    
    if (usersData[savedUser]) {
      currentUser = savedUser;
      document.getElementById('loginContainer').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
      updateUserData();
      updateAllBalances();
      initWatchlist();
      updateCurrentTime();
      initCompanyList();
    } else {
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('currentUser');
    }
  } else {
    document.getElementById('loginContainer').style.display = 'flex';
    document.getElementById('mainContent').style.display = 'none';
  }
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ localStorage
let storageAvailable = true;
try {
  const testKey = '__test';
  localStorage.setItem(testKey, '1');
  localStorage.removeItem(testKey);
} catch (e) {
  storageAvailable = false;
  alert("‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –í–∞—à –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö. –°–¥–µ–ª–∫–∏ –Ω–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.");
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤
function initWatchlist() {
  const watchlist = [
    { symbol: 'BTC/USDT', price: 89962.22, change: 2.99 },
    { symbol: 'ETH/USDT', price: 9917.45, change: 1.15 },
    { symbol: 'AAPL', price: 790.12, change: 0.97 },
    { symbol: 'TSLA', price: 802.39, change: 3.86 },
    { symbol: 'NVDA', price: 4929.91, change: 1.00 },
    { symbol: 'MSFT', price: 739.59, change: 1.31 }
  ];
  
  const watchlistContainer = document.getElementById('watchlist');
  watchlistContainer.innerHTML = '';
  
  watchlist.forEach(asset => {
    const item = document.createElement('div');
    item.className = 'watchlist-item';
    item.onclick = () => selectAsset(asset.symbol.split('/')[0]);
    
    const changeClass = asset.change >= 0 ? 'positive' : 'negative';
    const changeSign = asset.change >= 0 ? '+' : '';
    
    item.innerHTML = `
      <div class="asset-name">${asset.symbol}</div>
      <div class="asset-price">${asset.price.toLocaleString()}</div>
      <div class="asset-change ${changeClass}">${changeSign}${asset.change}%</div>
    `;
    
    watchlistContainer.appendChild(item);
  });
  
  updateWatchlistPrices();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –≤ —Å–ø–∏—Å–∫–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤
function updateWatchlistPrices() {
  const items = document.querySelectorAll('.watchlist-item');
  
  items.forEach(item => {
    const priceElement = item.querySelector('.asset-price');
    const changeElement = item.querySelector('.asset-change');
    
    if (priceElement && changeElement) {
      const currentPrice = parseFloat(priceElement.textContent.replace(/,/g, ''));
      const currentChange = parseFloat(changeElement.textContent);
      
      const priceChange = (Math.random() * 10 - 5) / 100;
      const newPrice = currentPrice * (1 + priceChange / 100);
      const newChange = currentChange + priceChange;
      
      priceElement.textContent = newPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
      changeElement.textContent = (newChange >= 0 ? '+' : '') + newChange.toFixed(2) + '%';
      changeElement.className = `asset-change ${newChange >= 0 ? 'positive' : 'negative'}`;
    }
  });
  
  updateMarketData();
  setTimeout(updateWatchlistPrices, 3000);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
function updateMarketData() {
  const priceElement = document.getElementById('currentPrice');
  const volumeElement = document.getElementById('dailyVolume');
  const changeElement = document.getElementById('dailyChange');
  
  if (priceElement) {
    const currentPrice = parseFloat(priceElement.textContent.split(' ')[0]);
    const newPrice = (currentPrice + (Math.random() * 0.5 - 0.25)).toFixed(2);
    priceElement.textContent = `${newPrice} USD`;
    priceElement.style.color = newPrice > currentPrice ? '#16c784' : '#ea3943';
    setTimeout(() => priceElement.style.color = '#c9d1d9', 500);
  }
  
  if (volumeElement) {
    const currentVolume = parseFloat(volumeElement.textContent);
    const newVolume = (currentVolume + (Math.random() * 100 - 50)).toFixed(0);
    volumeElement.textContent = `${Math.abs(newVolume)} BTC`;
  }
  
  if (changeElement) {
    const currentChange = parseFloat(changeElement.textContent);
    const newChange = (currentChange + (Math.random() * 0.5 - 0.25)).toFixed(2);
    changeElement.textContent = `${newChange}%`;
    changeElement.style.color = newChange >= 0 ? '#16c784' : '#ea3943';
  }
  
  const btcDominance = document.getElementById('btcDominance');
  const fearGreed = document.getElementById('fearGreed');
  const totalMarketCap = document.getElementById('totalMarketCap');
  const volume24h = document.getElementById('volume24h');
  
  if (btcDominance) {
    const currentBtcDom = parseFloat(btcDominance.textContent);
    const newBtcDom = (currentBtcDom + (Math.random() * 0.2 - 0.1)).toFixed(1);
    btcDominance.textContent = `${newBtcDom}%`;
  }
  
  if (fearGreed) {
    const currentFearGreed = parseInt(fearGreed.textContent);
    const newFearGreed = Math.max(0, Math.min(100, currentFearGreed + Math.floor(Math.random() * 5 - 2)));
    fearGreed.textContent = newFearGreed;
    fearGreed.style.color = newFearGreed > 50 ? '#16c784' : newFearGreed > 25 ? '#ffcc00' : '#ea3943';
  }
}

// –í—ã–±–æ—Ä –∞–∫—Ç–∏–≤–∞ –∏–∑ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏–ª–∏ —Å–ø–∏—Å–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö
function selectAsset(symbol) {
  document.getElementById("selectedCompany").textContent = symbol;
  document.getElementById("companyTitle").textContent = symbol;
  
  const overrides = {
    "BTC": "BINANCE:BTCUSDT",
    "ETH": "BINANCE:ETHUSDT",
    "AAPL": "NASDAQ:AAPL",
    "MSFT": "NASDAQ:MSFT",
    "GOOGL": "NASDAQ:GOOGL",
    "AMZN": "NASDAQ:AMZN",
    "TSLA": "NASDAQ:TSLA",
    "SHEL": "NYSE:SHEL",
    "NVDA": "NASDAQ:NVDA",
    "META": "NASDAQ:META",
    "NFLX": "NASDAQ:NFLX",
    "INTC": "NASDAQ:INTC",
    "AMD": "NASDAQ:AMD",
    "BABA": "NYSE:BABA",
    "ORCL": "NYSE:ORCL",
    "CRM": "NYSE:CRM",
    "ADBE": "NASDAQ:ADBE",
    "QCOM": "NASDAQ:QCOM",
    "UBER": "NYSE:UBER",
    "PYPL": "NASDAQ:PYPL",
    "T": "NYSE:T",
    "DIS": "NYSE:DIS",
    "KO": "NYSE:KO",
    "PEP": "NASDAQ:PEP",
    "WMT": "NYSE:WMT",
    "MCD": "NYSE:MCD",
    "XOM": "NYSE:XOM",
    "CVX": "NYSE:CVX",
    "BA": "NYSE:BA"
  };
  
  const tvSymbol = overrides[symbol] || `NASDAQ:${symbol}`;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞
  document.getElementById("companyTitle").textContent = symbol;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º iframe —Å –≥—Ä–∞—Ñ–∏–∫–æ–º
  const chartFrame = document.getElementById("chartFrame");
  chartFrame.src = `https://www.tradingview.com/widgetembed/?symbol=${tvSymbol}&interval=1&theme=dark`;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  updateMarketData();
  
  // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é
  document.getElementById("dropdown").style.display = "none";
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
function updateChartData() {
  // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
  const selectedCompany = document.getElementById("selectedCompany").textContent;
  if (selectedCompany) {
    updateMarketData();
  }
}

setInterval(updateChartData, 2000);

function updateLeverage(val) {
  document.getElementById("leverage-value").textContent = val + "x";
}

const companies = [
  "AAPL", "MSFT", "GOOGL", "AMZN", "TSLA", "SHEL", "NVDA", "META",
  "NFLX", "INTC", "AMD", "BABA", "ORCL", "CRM", "ADBE", "QCOM", "UBER",
  "PYPL", "T", "DIS", "KO", "PEP", "WMT", "MCD", "XOM", "CVX", "BA"
];

function toggleDropdown() {
  const dropdown = document.getElementById("dropdown");
  dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
  if (dropdown.style.display === "block") {
    filterCompanies("");
    document.getElementById("dropdown").querySelector("input").focus();
  }
}

function filterCompanies(search = "") {
  const filtered = companies.filter(c => c.toLowerCase().includes(search.toLowerCase()));
  const companyList = document.getElementById("companyList");
  companyList.innerHTML = "";
  filtered.forEach(company => {
    const div = document.createElement("div");
    div.textContent = company;
    div.onclick = () => selectAsset(company);
    companyList.appendChild(div);
  });
}

document.addEventListener("click", function(e) {
  if (!e.target.closest(".selector-container")) {
    document.getElementById("dropdown").style.display = "none";
  }
});

function openPosition(type) {
  if (!currentUser) return;
  
  const savedDeals = storageAvailable ? JSON.parse(localStorage.getItem("deals") || "[]") : [];
  const company = document.getElementById("selectedCompany").textContent;
  const leverage = document.getElementById("leverage").value;
  const amountInput = document.querySelector('input[type="number"]').value || 0;

  const dealBlock = document.createElement("div");
  dealBlock.className = "deal-block";

  const directionColor = type === "–õ–æ–Ω–≥" ? "#16c784" : "#ea3943";

  dealBlock.innerHTML = `
    <div><strong>${company}USDT</strong> <span style="color:${directionColor}">${type}</span> <span>–ö—Ä–æ—Å—Å</span> <span>${leverage}x</span></div>
    <div class="deal-row">
      <div class="deal-column">
        <div>–°—Ä. —Ü–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è: <span>${(Math.random() * 5 + 1).toFixed(4)}</span> USDT</div>
      </div>
      <div class="deal-column">
        <div>–í—Å–µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–æ: <span>${parseFloat(amountInput).toFixed(2)}</span> USDT</div>
      </div>
      <div class="deal-column">
        <div>–ü/–£ –ø–æ–∑–∏—Ü–∏–∏: <span class="profit">‚Äî</span> USDT</div>
        <div>–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ü/–£: <span class="realized">‚Äî</span> USDT</div>
      </div>
    </div>
  `;

  // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–º–æ–±–∏–ª—å–Ω—ã–π –∏ –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–π)
  const mobileContainer = document.getElementById("positionsContainer");
  const desktopContainer = document.getElementById("desktopPositionsContainer");
  
  const mobileDealBlock = dealBlock.cloneNode(true);
  const desktopDealBlock = dealBlock.cloneNode(true);
  
  mobileContainer.prepend(mobileDealBlock);
  desktopContainer.prepend(desktopDealBlock);
  
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –ø–æ–∑–∏—Ü–∏–π
  while (mobileContainer.children.length > 5) {
    mobileContainer.removeChild(mobileContainer.lastChild);
  }
  while (desktopContainer.children.length > 5) {
    desktopContainer.removeChild(desktopContainer.lastChild);
  }

  const timestamp = Date.now();
  const tp = type === '–õ–æ–Ω–≥' ? document.querySelector('#tp-sl-long input[placeholder*="Take"]')?.value : document.querySelector('#tp-sl-short input[placeholder*="Take"]')?.value;
  const sl = type === '–õ–æ–Ω–≥' ? document.querySelector('#tp-sl-long input[placeholder*="Stop"]')?.value : document.querySelector('#tp-sl-short input[placeholder*="Stop"]')?.value;
  const timeOpened = new Date().toLocaleTimeString();

  const dealData = {
    company,
    leverage,
    type,
    amount: parseFloat(amountInput).toFixed(2),
    openPrice: (Math.random() * 5 + 1).toFixed(4),
    tp,
    sl,
    timeOpened,
    timestamp
  };
  
  savedDeals.unshift(dealData);
  if (storageAvailable) {
    const trimmedDeals = savedDeals.slice(0, 5);
    localStorage.setItem("deals", JSON.stringify(trimmedDeals));
  }

  const tpInfo = tp ? `TP: ${tp}` : 'TP: ‚Äî';
  const slInfo = sl ? `SL: ${sl}` : 'SL: ‚Äî';
  const timeInfo = `–í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è: ${timeOpened}`;

  const infoColumn = document.createElement('div');
  infoColumn.className = 'deal-column';
  infoColumn.innerHTML = `<div>${tpInfo}</div><div>${slInfo}</div><div>${timeInfo}</div>`;
  
  mobileDealBlock.querySelector('.deal-row').appendChild(infoColumn.cloneNode(true));
  desktopDealBlock.querySelector('.deal-row').appendChild(infoColumn.cloneNode(true));

  updateBalanceInfo();
}

function toggleTPSL(checkbox, targetId) {
  const target = document.getElementById(targetId);
  target.style.display = checkbox.checked ? 'block' : 'none';
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–¥–µ–ª–æ–∫ –∏–∑ localStorage –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
window.addEventListener("load", () => {
  if (storageAvailable) {
    let savedDeals = JSON.parse(localStorage.getItem("deals") || "[]");
    savedDeals = savedDeals.slice(0, 5);
    
    // –û—á–∏—â–∞–µ–º –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    document.getElementById("positionsContainer").innerHTML = "";
    document.getElementById("desktopPositionsContainer").innerHTML = "";
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤ –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    savedDeals.forEach(deal => {
      restorePosition(deal);
    });
  }
  updateMarketData();
});

function restorePosition(deal) {
  const dealBlock = document.createElement("div");
  dealBlock.className = "deal-block";

  const directionColor = deal.type === "–õ–æ–Ω–≥" ? "#16c784" : "#ea3943";

  dealBlock.innerHTML = `
    <div><strong>${deal.company}USDT</strong> <span style="color:${directionColor}">${deal.type}</span> <span>–ö—Ä–æ—Å—Å</span> <span>${deal.leverage}x</span></div>
    <div class="deal-row">
      <div class="deal-column">
        <div>–°—Ä. —Ü–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è: <span>${deal.openPrice}</span> USDT</div>
      </div>
      <div class="deal-column">
        <div>–í—Å–µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–æ: <span>${deal.amount}</span> USDT</div>
      </div>
      <div class="deal-column">
        <div>–ü/–£ –ø–æ–∑–∏—Ü–∏–∏: <span class="profit">‚Äî</span> USDT</div>
        <div>–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ü/–£: <span class="realized">‚Äî</span> USDT</div>
      </div>
    </div>
  `;

  // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
  const mobileContainer = document.getElementById("positionsContainer");
  const desktopContainer = document.getElementById("desktopPositionsContainer");
  
  const mobileDealBlock = dealBlock.cloneNode(true);
  const desktopDealBlock = dealBlock.cloneNode(true);
  
  mobileContainer.prepend(mobileDealBlock);
  desktopContainer.prepend(desktopDealBlock);

  const tpInfo = deal.tp ? `TP: ${deal.tp}` : 'TP: ‚Äî';
  const slInfo = deal.sl ? `SL: ${deal.sl}` : 'SL: ‚Äî';
  const timeInfo = `–í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è: ${deal.timeOpened}`;

  const infoColumn = document.createElement('div');
  infoColumn.className = 'deal-column';
  infoColumn.innerHTML = `<div>${tpInfo}</div><div>${slInfo}</div><div>${timeInfo}</div>`;
  
  mobileDealBlock.querySelector('.deal-row').appendChild(infoColumn.cloneNode(true));
  desktopDealBlock.querySelector('.deal-row').appendChild(infoColumn.cloneNode(true));
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ü—Ä–æ—Ñ–∏–ª—å
function showKycMessage() {
  alert("–í —Å–≤—è–∑–∏ —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é KYC –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ–π—Ç–∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ 48 –¥–Ω–µ–π –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏\n\n–î–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–∞–º –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–∏—Ä–∂–∏\n\n–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥–µ—Ç —Å–∫—Ä—ã—Ç—ã –Ω–∞ —Å–∞–π—Ç–µ, –Ω–æ –±—É–¥—É—Ç –ø–æ—Å—Ç—É–ø–∞—Ç—å –≤–∞–º –Ω–∞ –ø–æ—á—Ç—É\n\n–ü—Ä–∏—è—Ç–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏");
}

function changePassword() {
  alert("–§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –î–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.");
}

function enable2FA() {
  alert("–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è KYC –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.");
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –î–µ–ø–æ–∑–∏—Ç
document.addEventListener('DOMContentLoaded', function() {
  const walletTabs = document.querySelectorAll('.wallet-tab');
  walletTabs.forEach(tab => {
    tab.addEventListener('click', function() {
      walletTabs.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      
      document.querySelectorAll('.wallet-content').forEach(content => {
        content.classList.remove('active');
      });
      
      const walletId = this.getAttribute('data-wallet');
      document.getElementById(`${walletId}-wallet`).classList.add('active');
    });
  });

  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const address = this.closest('.qr-code-container').querySelector('.wallet-address').textContent;
      navigator.clipboard.writeText(address)
        .then(() => {
          const originalText = this.textContent;
          this.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
          this.classList.add('copied');
          
          setTimeout(() => {
            this.textContent = originalText;
            this.classList.remove('copied');
          }, 2000);
        })
        .catch(err => {
          console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
          const textArea = document.createElement('textarea');
          textArea.value = address;
          document.body.appendChild(textArea);
          textArea.select();
          try {
            document.execCommand('copy');
            const originalText = this.textContent;
            this.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
            this.classList.add('copied');
            
            setTimeout(() => {
              this.textContent = originalText;
              this.classList.remove('copied');
            }, 2000);
          } catch (fallbackErr) {
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é.');
          }
          document.body.removeChild(textArea);
        });
    });
  });
});

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –í—ã–≤–æ–¥
function switchWithdrawTab(type) {
  document.querySelectorAll('.withdraw-tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.form-section').forEach(sec => sec.classList.remove('active'));

  document.querySelector(`.withdraw-tab[onclick="switchWithdrawTab('${type}')"]`).classList.add('active');
  document.getElementById(type).classList.add('active');
}

function showVipModal() {
  document.getElementById('vipModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeVipModal() {
  document.getElementById('vipModal').classList.remove('active');
  document.body.style.overflow = 'auto';
}

// –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–†–ê–ë–û–¢–ö–ò –í–´–í–û–î–ê –° –£–ß–ï–¢–û–ú –¢–†–ï–• –¢–ò–ü–û–í –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
async function showCommissionModal() {
  if (!currentUser) return;
  
  const user = usersData[currentUser];
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –≤—ã–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  if (user.withdrawType === "normal") {
    showNormalModal();        // üëà –ù–û–í–´–ô –¢–ò–ü 3
  } else if (user.withdrawType === "request") {
    showRequestModal();       // üëà –¢–ò–ü 2
  } else {
    showCommissionModalOld(); // üëà –¢–ò–ü 1
  }
}

// –°–¢–ê–†–ê–Ø –§–£–ù–ö–¶–ò–Ø –ö–û–ú–ò–°–°–ò–ò (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞)
function showCommissionModalOld() {
  document.getElementById('commissionModal').classList.add('active');
  document.body.style.overflow = 'hidden';
  document.getElementById('agreeCheckbox').checked = false;
  document.getElementById('continueBtn').disabled = true;
  document.getElementById('supportMessage').style.display = 'none';
  document.querySelector('.checkbox-container').style.display = 'flex';
  document.querySelector('.modal-footer').style.display = 'flex';
}

// –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –¢–ò–ü–ê REQUEST
function showRequestModal() {
  document.getElementById('requestModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –¢–ò–ü–ê NORMAL (–æ–±—ã—á–Ω—ã–π –≤—ã–≤–æ–¥)
function showNormalModal() {
  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
  const amount = document.getElementById('withdraw-amount-crypto').value || '100.00';
  const walletAddress = document.getElementById('wallet-address').value || '0x742d35Cc6634C0532925a3b8D...';
  
  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é (1% –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞)
  const networkFee = (parseFloat(amount) * (SYSTEM_CONFIG.FEES.normal / 100)).toFixed(2);
  const receiveAmount = (parseFloat(amount) - parseFloat(networkFee)).toFixed(2);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
  document.getElementById('withdrawAmount').textContent = amount + ' USDT';
  document.getElementById('networkFee').textContent = networkFee + ' USDT';
  document.getElementById('receiveAmount').textContent = receiveAmount + ' USDT';
  document.getElementById('walletAddressDisplay').textContent = walletAddress;
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
  startCountdownTimer();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  document.getElementById('normalModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–∞–π–º–µ—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
function startCountdownTimer() {
  let timeLeft = 24 * 60 * 60; // 24 —á–∞—Å–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
  
  if (countdownInterval) {
    clearInterval(countdownInterval);
  }
  
  countdownInterval = setInterval(() => {
    timeLeft--;
    
    if (timeLeft <= 0) {
      clearInterval(countdownInterval);
      document.getElementById('timerValue').textContent = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
      document.getElementById('timerValue').style.color = '#16c784';
      return;
    }
    
    const hours = Math.floor(timeLeft / 3600);
    const minutes = Math.floor((timeLeft % 3600) / 60);
    const seconds = timeLeft % 60;
    
    document.getElementById('timerValue').textContent = 
      `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }, 1000);
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã –æ–±—ã—á–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
function cancelNormalWithdraw() {
  if (countdownInterval) {
    clearInterval(countdownInterval);
  }
  closeNormalModal();
  showToast('–í—ã–≤–æ–¥ –æ—Ç–º–µ–Ω–µ–Ω');
}

function closeNormalModal() {
  document.getElementById('normalModal').classList.remove('active');
  document.body.style.overflow = 'auto';
}

function closeRequestModal() {
  document.getElementById('requestModal').classList.remove('active');
  document.body.style.overflow = 'auto';
}

function closeCommissionModal() {
  document.getElementById('commissionModal').classList.remove('active');
  document.body.style.overflow = 'auto';
}

function toggleContinueButton() {
  const checkbox = document.getElementById('agreeCheckbox');
  const continueBtn = document.getElementById('continueBtn');
  continueBtn.disabled = !checkbox.checked;
}

function showSupportMessage() {
  document.querySelector('.checkbox-container').style.display = 'none';
  document.querySelector('.modal-footer').style.display = 'none';
  document.getElementById('supportMessage').style.display = 'block';
}

function showError() {
  const toast = document.getElementById("toast");
  toast.style.display = "block";
  setTimeout(() => {
    toast.style.display = "none";
  }, 4000);
}

function showToast(message, type = 'success') {
  const toast = document.getElementById("toast");
  toast.textContent = message;
  toast.style.backgroundColor = type === 'success' ? '#16c784' : 
                               type === 'error' ? '#ea3943' : 
                               type === 'info' ? '#1f6feb' : '#f85149';
  toast.style.display = "block";
  
  setTimeout(() => {
    toast.style.display = "none";
  }, 4000);
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–∫–Ω–∞
document.addEventListener('click', function(event) {
  const vipModal = document.getElementById('vipModal');
  const commissionModal = document.getElementById('commissionModal');
  const requestModal = document.getElementById('requestModal');
  const normalModal = document.getElementById('normalModal');
  
  if (event.target === vipModal) {
    closeVipModal();
  }
  if (event.target === commissionModal) {
    closeCommissionModal();
  }
  if (event.target === requestModal) {
    closeRequestModal();
  }
  if (event.target === normalModal) {
    closeNormalModal();
  }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeVipModal();
    closeCommissionModal();
    closeRequestModal();
    closeNormalModal();
  }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
async function updateUserBalanceManually(email, newBalance) {
  if (!supabase) {
    showToast('‚ùå Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
    return false;
  }
  
  try {
    const success = await updateUserBalanceInSupabase(email, newBalance);
    if (success) {
      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      if (usersData[email]) {
        usersData[email].balance = newBalance.toString();
        if (currentUser === email) {
          updateAllBalances();
        }
      }
      showToast(`‚úÖ –ë–∞–ª–∞–Ω—Å ${email} –æ–±–Ω–æ–≤–ª–µ–Ω: ${newBalance} USDT`);
      return true;
    }
    return false;
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', error);
    showToast('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞', 'error');
    return false;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –≤—ã–≤–æ–¥–∞
async function updateWithdrawTypeManually(email, withdrawType) {
  if (!supabase) {
    showToast('‚ùå Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
    return false;
  }
  
  try {
    const success = await updateUserWithdrawTypeInSupabase(email, withdrawType);
    if (success) {
      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      if (usersData[email]) {
        usersData[email].withdrawType = withdrawType;
      }
      showToast(`‚úÖ –¢–∏–ø –≤—ã–≤–æ–¥–∞ ${email} –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${withdrawType}`);
      return true;
    }
    return false;
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –≤—ã–≤–æ–¥–∞:', error);
    showToast('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –≤—ã–≤–æ–¥–∞', 'error');
    return false;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
async function reloadUsersData() {
  if (!supabase) {
    showToast('‚ùå Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
    return false;
  }
  
  try {
    await loadUsersData();
    showToast('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Supabase');
    return true;
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:', error);
    showToast('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
    return false;
  }
}

// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ)
function addAdminControls() {
  const headerBar = document.querySelector('.header-bar');
  if (!headerBar) return;
  
  const adminButton = document.createElement('button');
  adminButton.textContent = 'üîÑ';
  adminButton.style.cssText = `
    background: none;
    border: none;
    color: #c9d1d9;
    font-size: 18px;
    cursor: pointer;
    margin-left: 10px;
    padding: 5px;
    border-radius: 4px;
  `;
  adminButton.title = '–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase';
  adminButton.onclick = reloadUsersData;
  
  const userMenu = document.querySelector('.user-menu');
  if (userMenu) {
    userMenu.insertBefore(adminButton, userMenu.firstChild);
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('load', function() {
  // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  addAdminControls();
  
  // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase
  setTimeout(() => {
    if (supabase) {
      console.log('üöÄ –¢–µ—Ä–º–∏–Ω–∞–ª –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å Supabase');
    }
  }, 1000);
});
</script>
</body>
</html>
