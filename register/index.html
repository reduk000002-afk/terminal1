<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #0a0e17;
            color: white;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #151f2e;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #2d3748;
        }
        
        h1 {
            color: #2563eb;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .test-section {
            background: #1a2332;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #2d3748;
        }
        
        .test-section h2 {
            color: #3b82f6;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #3b82f6;
        }
        
        .btn-green {
            background: #10b981;
        }
        
        .btn-red {
            background: #ef4444;
        }
        
        #result {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #2d3748;
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }
        
        .error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
        }
        
        .warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid #f59e0b;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .timestamp {
            color: #8b949e;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase</h1>
        
        <div class="test-section">
            <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
            <button class="btn" onclick="testConnection()">–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
            <button class="btn" onclick="testTables()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã</button>
            <div id="connectionResult"></div>
        </div>
        
        <div class="test-section">
            <h2>2. –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—É</h2>
            <button class="btn btn-green" onclick="testInsert()">–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É</button>
            <button class="btn btn-red" onclick="clearTestData()">–û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            <div id="insertResult"></div>
        </div>
        
        <div class="test-section">
            <h2>3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
            <button class="btn" onclick="getUsers()">–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <button class="btn" onclick="getUsersCount()">–ü–æ—Å—á–∏—Ç–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <div id="usersResult"></div>
        </div>
        
        <div class="test-section">
            <h2>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π</h2>
            <button class="btn" onclick="testAnonKey()">–¢–µ—Å—Ç anon –∫–ª—é—á–∞</button>
            <button class="btn" onclick="testServiceKey()">–¢–µ—Å—Ç service –∫–ª—é—á–∞</button>
            <div id="keysResult"></div>
        </div>
        
        <div class="test-section">
            <h2>5. –õ–æ–≥–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
            <div id="logs">
                <div class="log-entry"><span class="timestamp">[–ó–∞–≥—Ä—É–∑–∫–∞...]</span> –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üîß –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</h2>
            <div id="result">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...</div>
        </div>
    </div>

    <script>
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        const logsContainer = document.getElementById('logs');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            logsContainer.prepend(logEntry);
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function showMainResult(message, type = 'info') {
            const element = document.getElementById('result');
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // –ö–ª—é—á–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const SUPABASE_URL = 'https://wkukgnkfbxgpvlraczeu.supabase.co';
        const ANON_KEY = 'sb_publishable_11WBFNEcbspv1yDyfxq7sQ_Nl51ew5i';
        const SERVICE_KEY = 'sb_secret_-_i6bNuyDrQOrEn0JVLptQ_FQYLUDLf';
        
        let supabaseClient = null;
        
        // 1. –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        async function testConnection() {
            addLog('–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase...');
            
            try {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SERVICE_KEY);
                showResult('connectionResult', '‚úÖ Supabase –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω', 'success');
                addLog('Supabase –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω —Å service –∫–ª—é—á–æ–º');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                const { data, error } = await supabaseClient
                    .from('app_users')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    throw error;
                }
                
                showResult('connectionResult', '‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö!', 'success');
                addLog('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ —É—Å–ø–µ—à–Ω–æ');
                
            } catch (error) {
                showResult('connectionResult', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
                addLog(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
            }
        }
        
        // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
        async function testTables() {
            addLog('–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã...');
            
            try {
                // –ü–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—Ö–µ–º—É —á–µ—Ä–µ–∑ REST API
                const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
                    headers: {
                        'apikey': SERVICE_KEY,
                        'Authorization': `Bearer ${SERVICE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('connectionResult', '‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω, —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—É—á–µ–Ω—ã', 'success');
                    addLog(`API –¥–æ—Å—Ç—É–ø–µ–Ω. –û—Ç–≤–µ—Ç: ${JSON.stringify(data)}`);
                } else {
                    showResult('connectionResult', `‚ùå –û—à–∏–±–∫–∞ API: ${response.status}`, 'error');
                    addLog(`–û—à–∏–±–∫–∞ API: ${response.status}`);
                }
                
            } catch (error) {
                showResult('connectionResult', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü: ${error.message}`, 'error');
                addLog(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü: ${error.message}`);
            }
        }
        
        // 3. –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—É
        async function testInsert() {
            addLog('–ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...');
            
            try {
                const testEmail = `test${Date.now()}@test.com`;
                const testUser = `testuser${Date.now()}`;
                
                const { data, error } = await supabaseClient
                    .from('app_users')
                    .insert([
                        {
                            user_key: testUser,
                            password: 'test12345',
                            email: testEmail,
                            phone: '+7 999 999 9999',
                            country: 'RU',
                            balance: 1000.00,
                            level: '–°—Ç–∞–Ω–¥–∞—Ä—Ç',
                            withdraw_type: 'normal',
                            updated_by: 'test_page'
                        }
                    ]);
                
                if (error) {
                    throw error;
                }
                
                showResult('insertResult', `‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω!<br>–õ–æ–≥–∏–Ω: ${testUser}<br>Email: ${testEmail}`, 'success');
                addLog(`–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: ${testUser}`);
                
            } catch (error) {
                showResult('insertResult', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏: ${error.message}`, 'error');
                addLog(`–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏: ${error.message}`);
                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:', error);
                
                // –ü—Ä–æ–±—É–µ–º —Å anon –∫–ª—é—á–æ–º
                addLog('–ü—Ä–æ–±—É–µ–º —Å anon –∫–ª—é—á–æ–º...');
                try {
                    const supabaseAnon = window.supabase.createClient(SUPABASE_URL, ANON_KEY);
                    const testEmail = `test${Date.now()}@test.com`;
                    
                    const { data, error } = await supabaseAnon
                        .from('app_users')
                        .insert([
                            {
                                user_key: `test${Date.now()}`,
                                password: 'test12345',
                                email: testEmail,
                                updated_by: 'test_anon'
                            }
                        ]);
                    
                    if (error) throw error;
                    addLog('‚úÖ –ó–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ anon –∫–ª—é—á —É–¥–∞–ª–∞—Å—å!');
                    
                } catch (anonError) {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ anon –∫–ª—é—á–∞: ${anonError.message}`);
                }
            }
        }
        
        // 4. –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        async function clearTestData() {
            addLog('–û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...');
            
            try {
                const { error } = await supabaseClient
                    .from('app_users')
                    .delete()
                    .like('email', '%test%@test.com');
                
                if (error) throw error;
                
                showResult('insertResult', '‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'success');
                addLog('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
                
            } catch (error) {
                showResult('insertResult', `‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: ${error.message}`, 'error');
                addLog(`–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: ${error.message}`);
            }
        }
        
        // 5. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function getUsers() {
            addLog('–ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
            
            try {
                const { data, error } = await supabaseClient
                    .from('app_users')
                    .select('*')
                    .limit(10);
                
                if (error) throw error;
                
                let result = `‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${data.length}<br><br>`;
                data.forEach(user => {
                    result += `üë§ ${user.user_key} (${user.email}) - ${user.balance} USD<br>`;
                });
                
                showResult('usersResult', result, 'success');
                addLog(`–ü–æ–ª—É—á–µ–Ω–æ ${data.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
                
            } catch (error) {
                showResult('usersResult', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è: ${error.message}`, 'error');
                addLog(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${error.message}`);
            }
        }
        
        async function getUsersCount() {
            addLog('–°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
            
            try {
                const { count, error } = await supabaseClient
                    .from('app_users')
                    .select('*', { count: 'exact', head: true });
                
                if (error) throw error;
                
                showResult('usersResult', `‚úÖ –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ: ${count}`, 'success');
                addLog(`–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${count}`);
                
            } catch (error) {
                showResult('usersResult', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞: ${error.message}`, 'error');
                addLog(`–û—à–∏–±–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞: ${error.message}`);
            }
        }
        
        // 6. –¢–µ—Å—Ç –∫–ª—é—á–µ–π
        async function testAnonKey() {
            addLog('–¢–µ—Å—Ç–∏—Ä—É–µ–º anon –∫–ª—é—á...');
            
            try {
                const supabaseAnon = window.supabase.createClient(SUPABASE_URL, ANON_KEY);
                
                const { data, error } = await supabaseAnon
                    .from('app_users')
                    .select('count')
                    .limit(1);
                
                if (error) throw error;
                
                showResult('keysResult', '‚úÖ Anon –∫–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç (—á—Ç–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ)', 'success');
                addLog('Anon –∫–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —á—Ç–µ–Ω–∏—è');
                
            } catch (error) {
                showResult('keysResult', `‚ùå Anon –∫–ª—é—á –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}`, 'error');
                addLog(`Anon –∫–ª—é—á –æ—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        async function testServiceKey() {
            addLog('–¢–µ—Å—Ç–∏—Ä—É–µ–º service –∫–ª—é—á...');
            
            try {
                const supabaseService = window.supabase.createClient(SUPABASE_URL, SERVICE_KEY);
                
                const { data, error } = await supabaseService
                    .from('app_users')
                    .select('count')
                    .limit(1);
                
                if (error) throw error;
                
                showResult('keysResult', '‚úÖ Service –∫–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                addLog('Service –∫–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç');
                
            } catch (error) {
                showResult('keysResult', `‚ùå Service –∫–ª—é—á –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}`, 'error');
                addLog(`Service –∫–ª—é—á –æ—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        // –ê–≤—Ç–æ-–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            addLog('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...');
            
            // –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SERVICE_KEY);
            addLog('–°–æ–∑–¥–∞–Ω Supabase –∫–ª–∏–µ–Ω—Ç');
            
            // –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            testConnection();
        });
    </script>
</body>
</html>
